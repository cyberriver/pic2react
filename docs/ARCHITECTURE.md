# Архитектура React Component Generator

## Обзор системы

React Component Generator - это система для автоматической генерации React компонентов из изображений UI интерфейсов с использованием AI анализа и итеративной оптимизации.

## Общая архитектура

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Изображение   │───▶│   Vision AI     │───▶│ ComponentWorker │
│   (PNG/JPG)     │    │   (Claude 3.5)  │    │   (Гибридный)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │                        │
                                ▼                        ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │ Структурированные│    │ React компоненты│
                       │     данные      │    │   + стили       │
                       └─────────────────┘    └─────────────────┘
```

## Основные компоненты

### 1. VisionAnalyzer
**Назначение:** Анализ изображений UI через AI
**Вход:** Изображение (PNG/JPG/WebP)
**Выход:** Структурированные данные элементов

### 2. ComponentWorker
**Назначение:** Генерация React компонентов
**Вход:** Структурированные данные от Vision AI
**Выход:** React компоненты + стили

### 3. FileWatcher
**Назначение:** Мониторинг папки incoming
**Вход:** Файлы изображений
**Выход:** События добавления файлов

### 4. Web UI
**Назначение:** Интерфейс пользователя
**Функции:** Загрузка, предпросмотр, мониторинг

## Гибридный подход ComponentWorker

### Этап 1: Базовое сопоставление
```javascript
AI Analysis → React Component Type → Базовые параметры
```

### Этап 2: Итеративная оптимизация
```javascript
Базовые параметры → Оптимизация ключевых параметров → Валидация
```

### Этап 3: Визуальная валидация
```javascript
React компонент → Изображение → Сравнение с оригиналом
```

## Поток данных

### 1. Загрузка изображения
```
Пользователь → Web UI → API → FileWatcher → Очередь обработки
```

### 2. Анализ изображения
```
Изображение → VisionAnalyzer → Claude 3.5 Sonnet → Структурированные данные
```

### 3. Генерация компонентов
```
Структурированные данные → ComponentWorker → React компоненты
```

### 4. Сохранение результатов
```
React компоненты → FileManager → output/ папка
```

## Технологический стек

### Backend
- **Node.js** - основная платформа
- **Express.js** - веб-сервер
- **Socket.io** - real-time коммуникация
- **OpenRouter API** - доступ к Claude 3.5 Sonnet
- **Sharp** - обработка изображений
- **Winston** - логирование

### Frontend
- **React 18** - UI библиотека
- **TypeScript** - типизация
- **Material-UI** - компоненты
- **React Query** - управление состоянием
- **Vite** - сборка

### AI/ML
- **Claude 3.5 Sonnet** - анализ изображений
- **OpenRouter** - API провайдер
- **Итеративная оптимизация** - подгонка параметров

## Структура проекта

```
pic2react/
├── src/                    # Backend сервер
│   └── index.js           # Основной файл приложения
├── core/                   # Основные модули
│   ├── visionAnalyzer.js  # AI анализ изображений
│   ├── componentWorker.js # Генерация компонентов
│   ├── fileWatcher.js     # Мониторинг файлов
│   ├── projectAnalyzer.js # Анализ проектов
│   └── mockGenerator.js   # Генерация mock данных
├── config/                 # Конфигурационные файлы
│   ├── vision.json        # Настройки Vision API
│   ├── prompts.json       # Промпты для AI
│   └── settings.json      # Общие настройки
├── web-ui/                 # React frontend
│   ├── src/
│   │   ├── components/    # React компоненты
│   │   ├── pages/         # Страницы
│   │   └── utils/         # Утилиты
│   └── package.json
├── templates/              # Шаблоны компонентов
├── incoming/               # Папка для загрузки
├── output/                 # Сгенерированные компоненты
├── processed/              # Обработанные файлы
└── logs/                   # Логи системы
```

## Конфигурация

### Переменные окружения
```bash
OPENROUTER_API_KEY=sk-or-v1-...  # API ключ OpenRouter
PORT=3001                        # Порт backend сервера
LOG_LEVEL=debug                  # Уровень логирования
```

### Конфигурационные файлы
- `config/vision.json` - настройки Vision API
- `config/prompts.json` - промпты для AI
- `config/settings.json` - общие настройки

## API Endpoints

### Основные
- `GET /api/health` - проверка состояния системы
- `POST /api/images/upload` - загрузка изображений
- `GET /api/images/status/:id` - статус обработки
- `GET /api/components/:id` - получение компонентов
- `GET /api/components/preview/:id/:name` - предпросмотр компонента

### WebSocket
- `queue-updates` - обновления очереди
- `job-completed` - завершение задачи
- `job-failed` - ошибка задачи

## Безопасность

### API ключи
- Хранение в переменных окружения
- Не передача в клиентский код
- Ротация ключей

### Валидация файлов
- Проверка типов файлов
- Ограничение размера
- Санитизация имен файлов

## Мониторинг и логирование

### Логирование
- Winston для структурированных логов
- Разные уровни (debug, info, warn, error)
- Ротация логов по размеру

### Метрики
- Время обработки
- Использование токенов
- Успешность операций
- Производительность

## Масштабирование

### Горизонтальное
- Несколько инстансов backend
- Load balancer
- Shared storage для файлов

### Вертикальное
- Увеличение ресурсов
- Оптимизация алгоритмов
- Кэширование результатов

## Развертывание

### Development
```bash
npm run dev          # Backend
cd web-ui && npm run dev  # Frontend
```

### Production
```bash
npm run build        # Сборка
npm start           # Запуск
```

## Будущие улучшения

### Краткосрочные (1-2 месяца)
- Улучшение точности анализа
- Добавление новых типов компонентов
- Оптимизация производительности

### Долгосрочные (3-6 месяцев)
- Машинное обучение для оптимизации
- Поддержка дополнительных UI библиотек
- Интеграция с IDE
- Экспорт в различные форматы
